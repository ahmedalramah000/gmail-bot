# ุฅุตูุงุญุงุช ุดุงููุฉ ูุจูุช Gmail-Telegram

ูุฐุง ุงูููู ูุญุชูู ุนูู ุชุนูููุงุช ูุฅุตูุงุญ ุฌููุน ุงููุดููุงุช ุงููุนุฑููุฉ ูู ุจูุช Gmail-Telegram ุงูุฐู ูุณุชุฎุฑุฌ ุฃููุงุฏ ุชุญูู OpenAI ูู Gmail ููุฑุณููุง ูููุณุชุฎุฏููู ุนุจุฑ Telegram.

## ุงููุดููุงุช ุงููุนุฑููุฉ:

1. **ูุนุงูุฌุฉ ุงูุฃุฒุฑุงุฑ ุงูููุฑุฑุฉ**: ุงูุจูุช ูุนุงูุฌ ููุณ ุงูููุฑุฉ ุนูู ุงูุฒุฑ ุนุฏุฉ ูุฑุงุช
2. **ุฃุฎุทุงุก ุชุนุฏูู ุงูุฑุณุงุฆู**: ุงูุจูุช ููุดู ุนูุฏ ูุญุงููุฉ ุชุนุฏูู ุฑุณุงุฆู ูุญุฐููุฉ ุฃู ุบูุฑ ูุงุจูุฉ ููุชุนุฏูู
3. **ูุนุงูุฌุฉ ุงูุจุฑูุฏ ุงูููุฑุฑ**: ุงูุจูุช ูุนุงูุฌ ููุณ ุฑุณุงูุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุฃูุซุฑ ูู ูุฑุฉ
4. **ุบูุงุจ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงูุดุงููุฉ**: ุงูุจูุช ูุชููู ุนูุฏ ููุงุฌูุฉ ุฎุทุฃ ุบูุฑ ูุชููุน

## ุงูุฅุตูุงุญุงุช ุงููุทููุจุฉ:

### ุงูุฎุทูุฉ 1: ุฅุถุงูุฉ ุงููุชุบูุฑุงุช ุงูุนุงูุฉ ูุชุชุจุน ุงูุญุงูุฉ
ุฃุถู ุงูุดููุฑุฉ ุงูุชุงููุฉ ุจุนุฏ ุชุนุฑูู ุงููุชุบูุฑ logger ูุจุงุดุฑุฉ:

```python
# ูุฌููุนุฉ ูุชุฎุฒูู ูุนุฑูุงุช ุงูุงุณุชุฌุงุจุงุช ุงูุชู ุชูุช ูุนุงูุฌุชูุง
processed_callbacks = set()
# ุชุฎุฒูู ูุนุฑู ุขุฎุฑ ุจุฑูุฏ ุฅููุชุฑููู ุชูุช ูุนุงูุฌุชู
last_processed_email_id = None
```

### ุงูุฎุทูุฉ 2: ุชุญุฏูุซ ุฏุงูุฉ button_callback ูููุน ุงููุนุงูุฌุฉ ุงูููุฑุฑุฉ
ุงุณุชุจุฏู ุงูุดููุฑุฉ ุงูุญุงููุฉ ุจุฏุงูุฉ button_callback ุงูุฌุฏูุฏุฉ:

```python
async def button_callback(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ูุนุงูุฌุฉ ููุฑุงุช ุงูุฃุฒุฑุงุฑ."""
    global TUTORIAL_VIDEO_FILE_ID, processed_callbacks, last_processed_email_id
    query = update.callback_query
    user_id = str(update.effective_user.id)
    
    # ุชุฌูุจ ูุนุงูุฌุฉ ููุณ ุงูุงุณุชุฌุงุจุฉ ุนุฏุฉ ูุฑุงุช
    callback_id = f"{query.message.message_id}_{query.data}"
    if callback_id in processed_callbacks:
        await query.answer("ุฌุงุฑู ุงููุนุงูุฌุฉ...")
        return
        
    # ุฅุถุงูุฉ ุฅูู ุงูุงุณุชุฌุงุจุงุช ุงููุนุงูุฌุฉ
    processed_callbacks.add(callback_id)
    
    # ุชูุธูู ูุฌููุนุฉ ุงูุงุณุชุฌุงุจุงุช ุฅุฐุง ุฃุตุจุญุช ูุจูุฑุฉ ุฌุฏูุง
    if len(processed_callbacks) > 1000:
        # ุญุฐู ุฃูุฏู 500 ุงุณุชุฌุงุจุฉ
        processed_callbacks = set(list(processed_callbacks)[-500:])
    
    await query.answer()
    
    if query.data == "get_chatgpt_code":
        # ุนุฑุถ ุฑุณุงูุฉ ุงูุชุธุงุฑ
        try:
            await query.edit_message_text("๐ ุฌุงุฑู ุงูุจุญุซ ุนู ุขุฎุฑ ููุฏ... ุงูุชุธุฑ ููููุงู")
        except telegram.error.BadRequest as e:
            logger.error(f"ูุดู ูู ุชุนุฏูู ุฑุณุงูุฉ ุงูุงูุชุธุงุฑ: {e}")
            try:
                await context.bot.send_message(
                    chat_id=query.message.chat_id,
                    text="๐ ุฌุงุฑู ุงูุจุญุซ ุนู ุขุฎุฑ ููุฏ... ุงูุชุธุฑ ููููุงู"
                )
            except Exception as e2:
                logger.error(f"ูุดู ูู ุฅุฑุณุงู ุฑุณุงูุฉ ุงูุชุธุงุฑ ุฌุฏูุฏุฉ: {e2}")
                return
        
        # ุงูุจุญุซ ุนู ุงูููุฏ
        code_info = self.get_latest_verification_code(user_id)
        
        keyboard = [
            [InlineKeyboardButton("๐ ุชุญุฏูุซ", callback_data="get_chatgpt_code")],
            [InlineKeyboardButton("๐ฌ ุดุงูุฏ ุดุฑุญ ุทุฑููุฉ ุงูุฏุฎูู", callback_data="show_tutorial")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        
        if code_info:
            if "error" in code_info and code_info["error"] == "rate_limit":
                keyboard_rate_limit = [
                    [InlineKeyboardButton("๐ฌ ุดุงูุฏ ุดุฑุญ ุทุฑููุฉ ุงูุฏุฎูู", callback_data="show_tutorial")]
                ]
                reply_markup_rate_limit = InlineKeyboardMarkup(keyboard_rate_limit)
                
                try:
                    await query.edit_message_text(
                        "โ๏ธ ููุฏ ุชุฌุงูุฒุช ุงูุญุฏ ุงูุฃูุตู ูู ุงูุทูุจุงุช. ูุฑุฌู ุงููุญุงููุฉ ูุงุญููุง.\n\n"
                        f"๐ง ุงูุจุฑูุฏ: <code>{TARGET_EMAIL}</code>\n"
                        f"๐ ูููุฉ ุงููุฑูุฑ: <code>{PASSWORD}</code>\n\n"
                        f"<b>๐ ุทุฑููุฉ ุงูุฏุฎูู:</b>\n"
                        f'1. ุงุถุบุท ุนูู "try another method" ูู ุงูุฃุณูู\n'
                        f'2. ุงุฎุชุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ุงูุฎูุงุฑ ุงูุซุงูุซ)\n'
                        f'3. ุฃุฏุฎู ุงูููุฏ ุงูุฐู ุณุชุญุตู ุนููู\n\n'
                        f"ุชูุช ุจุฑูุฌุชู ุจูุงุณุทู ุงุญูุฏ ุงูุฑูุงุญ",
                        reply_markup=reply_markup_rate_limit,
                        parse_mode='HTML'
                    )
                except telegram.error.BadRequest as e:
                    logger.error(f"ูุดู ูู ุชุญุฏูุซ ุฑุณุงูุฉ ุญุฏ ุงูุงุณุชุฎุฏุงู: {e}")
                    try:
                        await context.bot.send_message(
                            chat_id=query.message.chat_id,
                            text="โ๏ธ ููุฏ ุชุฌุงูุฒุช ุงูุญุฏ ุงูุฃูุตู ูู ุงูุทูุจุงุช. ูุฑุฌู ุงููุญุงููุฉ ูุงุญููุง.\n\n"
                            f"๐ง ุงูุจุฑูุฏ: <code>{TARGET_EMAIL}</code>\n"
                            f"๐ ูููุฉ ุงููุฑูุฑ: <code>{PASSWORD}</code>\n\n"
                            f"<b>๐ ุทุฑููุฉ ุงูุฏุฎูู:</b>\n"
                            f'1. ุงุถุบุท ุนูู "try another method" ูู ุงูุฃุณูู\n'
                            f'2. ุงุฎุชุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ุงูุฎูุงุฑ ุงูุซุงูุซ)\n'
                            f'3. ุฃุฏุฎู ุงูููุฏ ุงูุฐู ุณุชุญุตู ุนููู\n\n'
                            f"ุชูุช ุจุฑูุฌุชู ุจูุงุณุทู ุงุญูุฏ ุงูุฑูุงุญ",
                            reply_markup=reply_markup_rate_limit,
                            parse_mode='HTML'
                        )
                    except Exception as e2:
                        logger.error(f"ูุดู ูู ุฅุฑุณุงู ุฑุณุงูุฉ ุญุฏ ุงูุงุณุชุฎุฏุงู ุฌุฏูุฏุฉ: {e2}")
                return
            
            # ุนุฑุถ ุงูููุฏ ููุท ุจุทุฑููุฉ ุจุณูุทุฉ ูุน ุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู
            message = (
                f"๐ <b>ููุฏ ุงูุชุญูู ุงูุฎุงุต ุจู:</b>\n\n"
                f"<code>{code_info['code']}</code>\n\n"
                f"๐ง <b>ุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู:</b>\n"
                f"ุงูุจุฑูุฏ: <code>{TARGET_EMAIL}</code>\n"
                f"ุงูุจุงุณูุฑุฏ: <code>{PASSWORD}</code>\n\n"
                f"<b>๐ ุทุฑููุฉ ุงูุฏุฎูู:</b>\n"
                f'1. ุงุถุบุท ุนูู "try another method" ูู ุงูุฃุณูู\n'
                f'2. ุงุฎุชุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ุงูุฎูุงุฑ ุงูุซุงูุซ)\n'
                f'3. ุฃุฏุฎู ุงูููุฏ ุงููุนุฑูุถ ุฃุนูุงู\n\n'
                f"ุชูุช ุจุฑูุฌุชู ุจูุงุณุทู ุงุญูุฏ ุงูุฑูุงุญ"
            )
            
            try:
                await query.edit_message_text(
                    text=message,
                    reply_markup=reply_markup,
                    parse_mode='HTML'
                )
            except telegram.error.BadRequest as e:
                logger.error(f"ูุดู ูู ุชุนุฏูู ุฑุณุงูุฉ ุงูููุฏ: {e}")
                try:
                    await context.bot.send_message(
                        chat_id=query.message.chat_id,
                        text=message,
                        reply_markup=reply_markup,
                        parse_mode='HTML'
                    )
                except Exception as e2:
                    logger.error(f"ูุดู ูู ุฅุฑุณุงู ุฑุณุงูุฉ ุงูููุฏ ุฌุฏูุฏุฉ: {e2}")
        else:
            # ุฑุณุงูุฉ ูุญุณูุฉ ุนูุฏ ุนุฏู ูุฌูุฏ ููุฏ
            keyboard_no_code = [
                [InlineKeyboardButton("๐ ุชุญุฏูุซ", callback_data="get_chatgpt_code")],
                [InlineKeyboardButton("๐ฌ ุดุงูุฏ ุดุฑุญ ุทุฑููุฉ ุงูุฏุฎูู", callback_data="show_tutorial")]
            ]
            reply_markup_no_code = InlineKeyboardMarkup(keyboard_no_code)
            
            try:
                await query.edit_message_text(
                    f"โ ูู ูุชู ุงูุนุซูุฑ ุนูู ููุฏ ุชุญูู\nุญุงูู ูุฑู ุงุฎุฑู\n\n"
                    f"๐ง <b>ุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู:</b>\n"
                    f"ุงูุจุฑูุฏ: <code>{TARGET_EMAIL}</code>\n"
                    f"ุงูุจุงุณูุฑุฏ: <code>{PASSWORD}</code>\n\n"
                    f"<b>๐ ุทุฑููุฉ ุงูุฏุฎูู:</b>\n"
                    f'1. ุงุถุบุท ุนูู "try another method" ูู ุงูุฃุณูู\n'
                    f'2. ุงุฎุชุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ุงูุฎูุงุฑ ุงูุซุงูุซ)\n'
                    f'3. ุฃุฏุฎู ุงูููุฏ ุงูุฐู ุณุชุญุตู ุนููู\n\n'
                    f"ุชูุช ุจุฑูุฌุชู ุจูุงุณุทู ุงุญูุฏ ุงูุฑูุงุญ",
                    reply_markup=reply_markup_no_code,
                    parse_mode='HTML'
                )
            except telegram.error.BadRequest as e:
                logger.error(f"ูุดู ูู ุชุนุฏูู ุฑุณุงูุฉ ุนุฏู ูุฌูุฏ ููุฏ: {e}")
                try:
                    await context.bot.send_message(
                        chat_id=query.message.chat_id,
                        text=f"โ ูู ูุชู ุงูุนุซูุฑ ุนูู ููุฏ ุชุญูู\nุญุงูู ูุฑู ุงุฎุฑู\n\n"
                        f"๐ง <b>ุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู:</b>\n"
                        f"ุงูุจุฑูุฏ: <code>{TARGET_EMAIL}</code>\n"
                        f"ุงูุจุงุณูุฑุฏ: <code>{PASSWORD}</code>\n\n"
                        f"<b>๐ ุทุฑููุฉ ุงูุฏุฎูู:</b>\n"
                        f'1. ุงุถุบุท ุนูู "try another method" ูู ุงูุฃุณูู\n'
                        f'2. ุงุฎุชุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ุงูุฎูุงุฑ ุงูุซุงูุซ)\n'
                        f'3. ุฃุฏุฎู ุงูููุฏ ุงูุฐู ุณุชุญุตู ุนููู\n\n'
                        f"ุชูุช ุจุฑูุฌุชู ุจูุงุณุทู ุงุญูุฏ ุงูุฑูุงุญ",
                        reply_markup=reply_markup_no_code,
                        parse_mode='HTML'
                    )
                except Exception as e2:
                    logger.error(f"ูุดู ูู ุฅุฑุณุงู ุฑุณุงูุฉ ุนุฏู ูุฌูุฏ ููุฏ ุฌุฏูุฏุฉ: {e2}")
```

### ุงูุฎุทูุฉ 3: ุชุญุฏูุซ ุฏุงูุฉ get_latest_verification_code ูููุน ูุนุงูุฌุฉ ุงูุจุฑูุฏ ุงูููุฑุฑ
ุงุจุญุซ ุนู ุฏุงูุฉ `get_latest_verification_code` ูุชุฃูุฏ ูู ุฃููุง ุชุชุถูู ุงูููุทู ุงูุชุงูู:

```python
def get_latest_verification_code(self, user_id: str) -> Optional[dict]:
    """ุงุณุชุฑุฌุงุน ุขุฎุฑ ููุฏ ุชุญูู ูู Gmail."""
    global last_processed_email_id
    
    # ููุง ูููู ุฃู ูุธู ููุฏ ุงูุชุญูู ูู ุจูุงูุงุช ุงูุงุนุชูุงุฏ ูุงูุชุนุงูู ูุน ุญุฏูุฏ ุงูุงุณุชุฎุฏุงู
    
    # ุงุณุชุฑุฌุงุน ุงูุฑุณุงุฆู
    try:
        messages = self.gmail.list_messages(search_query, max_results=10)
        
        if not messages:
            return None
        
        # ูุนุงูุฌุฉ ุงูุฑุณุงุฆู ูู ุงูุฃุญุฏุซ ุฅูู ุงูุฃูุฏู
        for msg in messages:
            msg_id = msg.get("id")
            
            # ุงูุชุญูู ููุง ุฅุฐุง ูุงู ูุฐุง ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุฏ ุชูุช ูุนุงูุฌุชู ุจุงููุนู
            if msg_id == last_processed_email_id:
                logger.info(f"ุชูุช ูุนุงูุฌุฉ ูุฐุง ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุจุงููุนู: {msg_id}")
                continue
                
            # ุจุงูู ุงูุดููุฑุฉ ุจุฏูู ุชุบููุฑ
            # ...
            
            if verification_code:
                # ุญูุธ ูุนุฑู ุงูุฑุณุงูุฉ ููุนุงูุฌุฉ ูุชุฌูุจ ูุนุงูุฌุชูุง ูุฑุฉ ุฃุฎุฑู
                last_processed_email_id = msg_id
                
                return {
                    "code": verification_code,
                    # ... ุจุงูู ุงูุจูุงูุงุช
                }
```

### ุงูุฎุทูุฉ 4: ุฅุถุงูุฉ ููุนุงููุฌ ุงูุฃุฎุทุงุก ุงูุนุงู
ุฃุถู ุงูุดููุฑุฉ ุงูุชุงููุฉ ูู ุฏุงูุฉ `main()` ูุจู ุณุทุฑ `application.run_polling()`:

```python
# ุฅุถุงูุฉ ูุนุงูุฌ ุงูุฃุฎุทุงุก
async def error_handler(update, context):
    """ุชุณุฌูู ุงูุฃุฎุทุงุก ุงูุชู ุชุณุจุจูุง ุงูุชุญุฏูุซุงุช."""
    logger.error(f"ุญุฏุซ ุงุณุชุซูุงุก ุฃุซูุงุก ูุนุงูุฌุฉ ุชุญุฏูุซ: {context.error}")
    
    # ุฅุฎุทุงุฑ ุงููุณุชุฎุฏู ุจุงูุฎุทุฃ ุฅุฐุง ูุงู ุฐูู ููุงุณุจูุง
    if update and update.effective_chat:
        try:
            await context.bot.send_message(
                chat_id=update.effective_chat.id,
                text="ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ูุนุงูุฌุฉ ุทูุจู. ุงูุฑุฌุงุก ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู."
            )
        except Exception as e:
            logger.error(f"ูุดู ูู ุฅุฑุณุงู ุฑุณุงูุฉ ุงูุฎุทุฃ: {e}")
            
application.add_error_handler(error_handler)
```

### ุงูุฎุทูุฉ 5: ุฅุตูุงุญ ุฌููุน ุนูููุงุช ุชุนุฏูู ุงูุฑุณุงุฆู
ุชุฃูุฏ ูู ุฃู ุฌููุน ุงุณุชุฏุนุงุกุงุช `edit_message_text` ูู ุงูููุฏ ุชุณุชุฎุฏู ูุชู try/except:

```python
try:
    await query.edit_message_text(
        # ูุญุชูู ุงูุฑุณุงูุฉ
    )
except telegram.error.BadRequest as e:
    logger.error(f"ูุดู ูู ุชุนุฏูู ุงูุฑุณุงูุฉ: {e}")
    try:
        await context.bot.send_message(
            chat_id=query.message.chat_id,
            # ููุณ ูุญุชูู ุงูุฑุณุงูุฉ
        )
    except Exception as e2:
        logger.error(f"ูุดู ูู ุฅุฑุณุงู ุฑุณุงูุฉ ุฌุฏูุฏุฉ: {e2}")
```

## ุงูุทุฑููุฉ ุงูุณููุฉ: ุงุณุชุฎุฏุงู ุณูุฑุจุช ุงูุฅุตูุงุญ ุงูุชููุงุฆู

ูุชุณููู ุนูููุฉ ุงูุฅุตูุงุญุ ููููู ุงุณุชุฎุฏุงู ุงูุณูุฑุจุช ุงูุชุงูู ูุชุทุจูู ุฌููุน ุงูุฅุตูุงุญุงุช ุชููุงุฆููุง:

1. ุชุฃูุฏ ูู ุชูุนูู ุจูุฆุฉ Python: `python -m venv venv` ุซู `venv\Scripts\activate` (Windows) ุฃู `source venv/bin/activate` (Linux/Mac)
2. ูู ุจุชุซุจูุช ุงูููุชุจุงุช ุงููุทููุจุฉ: `pip install -r requirements.txt`
3. ูู ุจุชุดุบูู ุณูุฑุจุช ุงูุฅุตูุงุญ: `python fix_bot.py`
4. ูู ุจุชุดุบูู ุงููุณุฎุฉ ุงููุตุญุญุฉ: `python fixed_gmail_bot.py`

ูุฐุง ุงูุณูุฑุจุช ุณูููู ุจุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ุงูููู ุงูุฃุตูู ุซู ุชุทุจูู ุฌููุน ุงูุฅุตูุงุญุงุช ุนูู ุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ.

## ุงูุชุญูู ูู ูุฌุงุญ ุงูุฅุตูุงุญุงุช

ุจุนุฏ ุชุทุจูู ุงูุฅุตูุงุญุงุชุ ูุฌุจ ููุงุญุธุฉ ุงูุชุงูู:

1. ุงูุจูุช ูู ูุนุงูุฌ ููุณ ุงูุฒุฑ ุนุฏุฉ ูุฑุงุช
2. ุงูุจูุช ูู ูุชููู ุนูุฏ ูุญุงููุฉ ุชุนุฏูู ุฑุณุงุฆู ูุญุฐููุฉ
3. ุงูุจูุช ุณูุฑุณู ุฑุณุงูุฉ ุฌุฏูุฏุฉ ุฅุฐุง ูุดู ูู ุชุนุฏูู ุฑุณุงูุฉ ููุฌูุฏุฉ
4. ุงูุจูุช ูู ูุนุงูุฌ ููุณ ุฑุณุงูุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุฃูุซุฑ ูู ูุฑุฉ
5. ุงูุจูุช ุณูุณุชูุฑ ูู ุงูุนูู ุญุชู ุนูุฏ ุญุฏูุซ ุฃุฎุทุงุก ุบูุฑ ูุชููุนุฉ 