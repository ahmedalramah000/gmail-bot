# تعديلات جديدة على البوت

## التغييرات الرئيسية التي تم إجراؤها على البوت:

### ١- تحميل ملفات المصادقة تلقائيًا من Google Drive
- تم إضافة خاصية لتحميل الملفات `credentials.json` و `token.json` تلقائيًا من Google Drive
- يتم تحميل الملفات عند بدء تشغيل البوت باستخدام روابط مباشرة من متغيرات البيئة
- الروابط يجب أن تكون بصيغة تنزيل مباشر: `https://drive.google.com/uc?export=download&id=...`

### ٢- تحسين التعامل مع ملف `token.json`
- تم تغيير طريقة التعامل مع ملف `token.json` عندما يكون غير موجود أو غير صالح
- البوت الآن يظهر رسالة خطأ واضحة دون محاولة إنشاء الملف تلقائيًا

### ٣- التعامل مع تعارض نسخ البوت
- تم إضافة معالجة خاصة لخطأ `Conflict` الذي يحدث عندما تكون هناك نسخة أخرى من البوت قيد التشغيل
- البوت يعرض رسالة واضحة ويتوقف دون محاولة إعادة التشغيل

## كيفية إعداد البوت الجديد:

### إعداد ملف `.env`
أضف المتغيرات التالية إلى ملف `.env`:

```
# روابط ملفات المصادقة من Google Drive
CREDENTIALS_URL=https://drive.google.com/uc?export=download&id=your_credentials_id
TOKEN_URL=https://drive.google.com/uc?export=download&id=your_token_id
```

### الخطوات المطلوبة:

١. **تحضير ملفات المصادقة**:
   - قم برفع ملفي `credentials.json` و `token.json` على Google Drive
   - احصل على روابط مشاركة للملفات
   - قم بتحويل الروابط إلى صيغة التنزيل المباشر

٢. **تحديث متغيرات البيئة**:
   - أضف الروابط إلى ملف `.env` تحت المتغيرات المناسبة
   - تأكد من أن الروابط صحيحة وتؤدي إلى تنزيل مباشر للملفات

٣. **تشغيل البوت**:
   - قم بتشغيل البوت باستخدام الأمر `python gmail_bot.py`
   - تحقق من سجل البوت للتأكد من تحميل الملفات بنجاح

## ملاحظات هامة:

- تأكد من أن روابط Google Drive مرئية لأي شخص يملك الرابط (مشاركة عامة)
- استخدم دائمًا رابط التحميل المباشر بالصيغة الصحيحة
- إذا واجهت أي مشاكل في تحميل الملفات، يمكنك وضعها يدويًا في نفس مجلد البوت

## أمثلة للروابط:

رابط مشاركة عادي:
```
https://drive.google.com/file/d/1AbCdEfGhIjKlMnOpQrStUvWxYz/view?usp=sharing
```

رابط التحميل المباشر (المطلوب):
```
https://drive.google.com/uc?export=download&id=1AbCdEfGhIjKlMnOpQrStUvWxYz
```

## تشخيص المشاكل:

إذا واجهت مشكلة في تشغيل البوت، تحقق من:

1. سجل البوت (`bot.log`) لمعرفة سبب الخطأ
2. صحة الروابط في ملف `.env`
3. وجود الملفات المحلية كنسخة احتياطية
4. وجود نسخة أخرى من البوت قيد التشغيل 